@page "/cadastro"
@layout Layout.LoginLayout
@inject CadastroViewModel ViewModel
@inject NavigationManager NavManager
@implements IDisposable

<div class="cadastro-wrapper">
    <div class="cadastro-container">
        <h1>Registre-se</h1>
        <p>Preencha os dados para criar sua conta</p>

        <EditForm Model="@ViewModel.Usuario" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator />

            <!-- Nome -->
            <InputText class="cad-input"
                       @bind-Value="ViewModel.Usuario.PrimeiroNome"
                       placeholder="Nome" />
            <ValidationMessage For="@(() => ViewModel.Usuario.PrimeiroNome)" />

            <!-- Sobrenome -->
            <InputText class="cad-input"
                       @bind-Value="ViewModel.Usuario.Sobrenome"
                       placeholder="Sobrenome" />
            <ValidationMessage For="@(() => ViewModel.Usuario.Sobrenome)" />

            <!-- Email -->
            <InputText class="cad-input"
                       @bind-Value="ViewModel.Usuario.Email"
                       type="email"
                       placeholder="Email" />
            <ValidationMessage For="@(() => ViewModel.Usuario.Email)" />

            <!-- Senha -->
            <InputText class="cad-input"
                       @bind-Value="ViewModel.Usuario.Senha"
                       type="password"
                       placeholder="Senha" />
            <ValidationMessage For="@(() => ViewModel.Usuario.Senha)" />

            <!-- Confirmar senha -->
            <InputText class="cad-input"
                       @bind-Value="ViewModel.Usuario.SenhaConfirmacao"
                       type="password"
                       placeholder="Confirme a senha" />
            <ValidationMessage For="@(() => ViewModel.Usuario.SenhaConfirmacao)" />

            @if (ViewModel.Carregando)
            {
                <div class="spinner"></div>
            }
            else
            {
                <button type="submit" class="btn-primary">Registrar</button>
                <button type="button" class="btn-secondary" @onclick="VoltarParaLogin">
                    Já tenho conta
                </button>
            }
        </EditForm>
    </div>
</div>

@code {
    private async Task HandleValidSubmit()
    {
        await ViewModel.RegisterCommand.ExecuteAsync(null);
    }

    private void VoltarParaLogin()
    {
        NavManager.NavigateTo("/");
    }

  

    protected override void OnInitialized()
    {
       
        ViewModel.PropertyChanged += OnViewModelPropertyChanged;
    }

   
    private void OnViewModelPropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
    {
        
        StateHasChanged();
    }

    public void Dispose()
    {
       
        ViewModel.PropertyChanged -= OnViewModelPropertyChanged;
    }

  
    }
}